<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Slow Transients Pipeline Prototype: /home/lucas/skadev/FastImaging/src/stp/common/spline.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="science_data_processor_logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Slow Transients Pipeline Prototype
   </div>
   <div id="projectbrief">Component of the Science Data Processor being developed in the context of the Square Kilometre Array international project, which provides fast snapshot imaging, object detection and cataloguing for the identification of astrophysical image-plane transients.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_71906deff00c706128a95d3938125d0a.html">stp</a></li><li class="navelem"><a class="el" href="dir_3b6b5a7fbb38c0273c9bd069d1271cfa.html">common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">spline.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="spline_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * spline.h</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * simple cubic spline interpolation library</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * ---------------------------------------------------------------------</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Copyright (C) 2018 Luis Lucas (luisfrlucas at gmail.com)</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Copyright (C) 2011, 2014 Tino Kluge (ttk448 at gmail.com)</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *  This program is free software; you can redistribute it and/or</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *  modify it under the terms of the GNU General Public License</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  as published by the Free Software Foundation; either version 2</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  of the License, or (at your option) any later version.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *  GNU General Public License for more details.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *  You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * ---------------------------------------------------------------------</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#ifndef TK_SPLINE_H</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#define TK_SPLINE_H</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;../types.h&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;armadillo&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacetk.html">tk</a> {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// band matrix solver</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classtk_1_1band__matrix.html">   36</a></span>&#160;<span class="keyword">class </span><a class="code" href="classtk_1_1band__matrix.html">band_matrix</a> {</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    arma::Mat&lt;real_t&gt; m_upper; <span class="comment">// upper band</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    arma::Mat&lt;real_t&gt; m_lower; <span class="comment">// lower band</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="classtk_1_1band__matrix.html#a5a62f404ad5ae5cf01229e975eb3f2e6">   41</a></span>&#160;    <a class="code" href="classtk_1_1band__matrix.html#a5a62f404ad5ae5cf01229e975eb3f2e6">band_matrix</a>() {} <span class="comment">// constructor</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="classtk_1_1band__matrix.html#a5a62f404ad5ae5cf01229e975eb3f2e6">band_matrix</a>(<span class="keywordtype">int</span> <a class="code" href="classtk_1_1band__matrix.html#a1d1f0012bb1ac68667de630a809d947b">dim</a>, <span class="keywordtype">int</span> n_u, <span class="keywordtype">int</span> n_l); <span class="comment">// constructor</span></div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classtk_1_1band__matrix.html#a1d5af61e7df839f41ca2957176ca4cff">   43</a></span>&#160;    <a class="code" href="classtk_1_1band__matrix.html#a1d5af61e7df839f41ca2957176ca4cff">~band_matrix</a>() {} <span class="comment">// destructor</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classtk_1_1band__matrix.html#ac228b0ec7dcb4546295b807c7ea1538e">setsize</a>(<span class="keywordtype">int</span> <a class="code" href="classtk_1_1band__matrix.html#a1d1f0012bb1ac68667de630a809d947b">dim</a>, <span class="keywordtype">int</span> n_u, <span class="keywordtype">int</span> n_l); <span class="comment">// init with dim,n_u,n_l</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classtk_1_1band__matrix.html#a1d1f0012bb1ac68667de630a809d947b">dim</a>() <span class="keyword">const</span>; <span class="comment">// matrix dimension</span></div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="classtk_1_1band__matrix.html#a964e9950c0f778b13a963e4acfa8d6ae">   46</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classtk_1_1band__matrix.html#a964e9950c0f778b13a963e4acfa8d6ae">num_upper</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">return</span> m_upper.n_cols - 1;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classtk_1_1band__matrix.html#a57b351eff7db8c9875a5204ea3132d42">   50</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classtk_1_1band__matrix.html#a57b351eff7db8c9875a5204ea3132d42">num_lower</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">return</span> m_lower.n_cols - 1;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// access operator</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; <a class="code" href="classtk_1_1band__matrix.html#a22a4e9304b833c37b5c76576aeb3abf0">operator()</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j); <span class="comment">// write</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1band__matrix.html#a22a4e9304b833c37b5c76576aeb3abf0">operator()</a>(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j) <span class="keyword">const</span>; <span class="comment">// read</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// we can store an additional diogonal (in m_lower)</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; <a class="code" href="classtk_1_1band__matrix.html#a4fd9ed003c3f0705cc7b18c2eae5c684">saved_diag</a>(<span class="keywordtype">int</span> i);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1band__matrix.html#a4fd9ed003c3f0705cc7b18c2eae5c684">saved_diag</a>(<span class="keywordtype">int</span> i) <span class="keyword">const</span>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classtk_1_1band__matrix.html#a58c5621f3a2b81621b8a52d2e7fd2da5">lu_decompose</a>();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    arma::Col&lt;real_t&gt; <a class="code" href="classtk_1_1band__matrix.html#a0c7d6395a84db25a968952e23fa30bab">r_solve</a>(<span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; b) <span class="keyword">const</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    arma::Col&lt;real_t&gt; <a class="code" href="classtk_1_1band__matrix.html#adaace3f1ce985888f2b7ef9c4fd4d166">l_solve</a>(<span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; b) <span class="keyword">const</span>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    arma::Col&lt;real_t&gt; <a class="code" href="classtk_1_1band__matrix.html#ab97d8bd7a025c3a9fb1202a65d2d3d93">lu_solve</a>(<span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; b, <span class="keywordtype">bool</span> is_lu_decomposed = <span class="keyword">false</span>);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;};</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">bool</span> isCubic = true&gt;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html">   72</a></span>&#160;<span class="keyword">class </span><a class="code" href="classtk_1_1spline.html">spline</a> {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dc">   74</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dc">bd_type</a> {</div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca36155d20be4c44f424eabc5855853216">   75</a></span>&#160;        <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca36155d20be4c44f424eabc5855853216">first_deriv</a> = 1,</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">   76</a></span>&#160;        <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">second_deriv</a> = 2</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    };</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    arma::Col&lt;real_t&gt; m_x, m_y; <span class="comment">// x,y coordinates of points</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// interpolation parameters</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// f(x) = a*(x-x_i)^3 + b*(x-x_i)^2 + c*(x-x_i) + y_i</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    arma::Col&lt;real_t&gt; m_a, m_b, m_c; <span class="comment">// spline coefficients</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> m_b0, m_c0; <span class="comment">// for left extrapol</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dc">bd_type</a> m_left, m_right;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> m_left_value, m_right_value;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">bool</span> m_force_linear_extrapolation;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a62687d7d2fcd1dbe07576bf937c088a7">   95</a></span>&#160;    <a class="code" href="classtk_1_1spline.html#a62687d7d2fcd1dbe07576bf937c088a7">spline</a>()</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        : m_left(<a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">second_deriv</a>)</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        , m_right(<a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">second_deriv</a>)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        , m_left_value(0.0)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        , m_right_value(0.0)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        , m_force_linear_extrapolation(false)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a39834bd1f061c6eacc4f6c45ab8e0b41">  108</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classtk_1_1spline.html#a39834bd1f061c6eacc4f6c45ab8e0b41">set_boundary</a>(<a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dc">bd_type</a> left, <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> left_value,</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dc">bd_type</a> right, <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> right_value,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordtype">bool</span> force_linear_extrapolation = <span class="keyword">false</span>)</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        assert(m_x.size() == 0); <span class="comment">// set_points() must not have happened yet</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        m_left = left;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        m_right = right;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        m_left_value = left_value;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        m_right_value = right_value;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        m_force_linear_extrapolation = force_linear_extrapolation;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#aa775760d2db2bd9c281f23cfdc264896">  129</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classtk_1_1spline.html#aa775760d2db2bd9c281f23cfdc264896">set_points</a>(<span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; x, <span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; y, <span class="keywordtype">bool</span> copy = <span class="keyword">true</span>)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        assert(x.size() == y.size());</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        assert(x.size() &gt; 2);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> (copy) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            m_x = x;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            m_y = y;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordtype">int</span> n = x.size();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">// TODO: maybe sort x and y, rather than returning an error</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n - 1; i++) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            assert(x[i] &lt; x[i + 1]);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> (isCubic == <span class="keyword">true</span>) { <span class="comment">// cubic spline interpolation</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="comment">// setting up the matrix and right hand side of the equation system</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="comment">// for the parameters b[]</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <a class="code" href="classtk_1_1band__matrix.html">band_matrix</a> A(n, 1, 1);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            arma::Col&lt;real_t&gt; rhs(n);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; n - 1; i++) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                A(i, i - 1) = 1.0 / 3.0 * (x[i] - x[i - 1]);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                A(i, i) = 2.0 / 3.0 * (x[i + 1] - x[i - 1]);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                A(i, i + 1) = 1.0 / 3.0 * (x[i + 1] - x[i]);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                rhs[i] = (y[i + 1] - y[i]) / (x[i + 1] - x[i]) - (y[i] - y[i - 1]) / (x[i] - x[i - 1]);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="comment">// boundary conditions</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">if</span> (m_left == <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">spline::second_deriv</a>) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                <span class="comment">// 2*b[0] = f&#39;&#39;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                A(0, 0) = 2.0;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                A(0, 1) = 0.0;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                rhs[0] = m_left_value;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_left == <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca36155d20be4c44f424eabc5855853216">spline::first_deriv</a>) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                <span class="comment">// c[0] = f&#39;, needs to be re-expressed in terms of b:</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="comment">// (2b[0]+b[1])(x[1]-x[0]) = 3 ((y[1]-y[0])/(x[1]-x[0]) - f&#39;)</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                A(0, 0) = 2.0 * (x[1] - x[0]);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                A(0, 1) = 1.0 * (x[1] - x[0]);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                rhs[0] = 3.0 * ((y[1] - y[0]) / (x[1] - x[0]) - m_left_value);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                assert(<span class="keyword">false</span>);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keywordflow">if</span> (m_right == <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">spline::second_deriv</a>) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                <span class="comment">// 2*b[n-1] = f&#39;&#39;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                A(n - 1, n - 1) = 2.0;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                A(n - 1, n - 2) = 0.0;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                rhs[n - 1] = m_right_value;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_right == <a class="code" href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca36155d20be4c44f424eabc5855853216">spline::first_deriv</a>) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                <span class="comment">// c[n-1] = f&#39;, needs to be re-expressed in terms of b:</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                <span class="comment">// (b[n-2]+2b[n-1])(x[n-1]-x[n-2])</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <span class="comment">// = 3 (f&#39; - (y[n-1]-y[n-2])/(x[n-1]-x[n-2]))</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                A(n - 1, n - 1) = 2.0 * (x[n - 1] - x[n - 2]);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                A(n - 1, n - 2) = 1.0 * (x[n - 1] - x[n - 2]);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                rhs[n - 1] = 3.0 * (m_right_value - (y[n - 1] - y[n - 2]) / (x[n - 1] - x[n - 2]));</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                assert(<span class="keyword">false</span>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="comment">// solve the equation system to obtain the parameters b[]</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            m_b = A.<a class="code" href="classtk_1_1band__matrix.html#ab97d8bd7a025c3a9fb1202a65d2d3d93">lu_solve</a>(rhs);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="comment">// calculate parameters a[] and c[] based on b[]</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            m_a.set_size(n);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            m_c.set_size(n);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n - 1; i++) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                m_a[i] = 1.0 / 3.0 * (m_b[i + 1] - m_b[i]) / (x[i + 1] - x[i]);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                m_c[i] = (y[i + 1] - y[i]) / (x[i + 1] - x[i])</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    - 1.0 / 3.0 * (2.0 * m_b[i] + m_b[i + 1]) * (x[i + 1] - x[i]);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// linear interpolation</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            m_c.set_size(n);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n - 1; i++) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                m_c[i] = (y[i + 1] - y[i]) / (x[i + 1] - x[i]);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (isCubic) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="comment">// for left extrapolation coefficients</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            m_b0 = (m_force_linear_extrapolation == <span class="keyword">false</span>) ? m_b[0] : 0.0;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            m_c0 = m_c[0];</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="comment">// for the right extrapolation coefficients</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="comment">// f_{n-1}(x) = b*(x-x_{n-1})^2 + c*(x-x_{n-1}) + y_{n-1}</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> h = x[n - 1] - x[n - 2];</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="comment">// m_b[n-1] is determined by the boundary condition</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            m_a[n - 1] = 0.0;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            m_c[n - 1] = 3.0 * m_a[n - 2] * h * h + 2.0 * m_b[n - 2] * h + m_c[n - 2]; <span class="comment">// = f&#39;_{n-2}(x_{n-1})</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">if</span> (m_force_linear_extrapolation == <span class="keyword">true</span>)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                m_b[n - 1] = 0.0;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            m_c0 = m_c[0];</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            m_c[n - 1] = m_c[n - 2];</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">// Find the lower bound index</span></div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a8400559a8bfbdc33528b1744109959ac">  222</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classtk_1_1spline.html#a8400559a8bfbdc33528b1744109959ac">mx_lower_bound</a>(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last, <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> x)<span class="keyword"> const</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">while</span> (first &lt; last) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordtype">int</span> mid = (first + last) &gt;&gt; 1;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordflow">if</span> (x &gt; m_x[mid]) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                first = mid + 1;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                last = mid;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        first = std::max(first - 1, 0);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">return</span> first;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a7071258ec9307832dce2ae288bd5dbf5">  244</a></span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1spline.html#a7071258ec9307832dce2ae288bd5dbf5">operator()</a>(<a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> x)<span class="keyword"> const</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordtype">size_t</span> n = m_x.size();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">// find the closest point m_x[idx] &lt; x, idx=0 even if x&lt;m_x[0]</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordtype">int</span> idx = <a class="code" href="classtk_1_1spline.html#a8400559a8bfbdc33528b1744109959ac">mx_lower_bound</a>(0, m_x.n_elem, x);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> h = x - m_x[idx];</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> interpol;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (x &lt; m_x[0]) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="comment">// extrapolation to the left</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordflow">if</span> (isCubic) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                interpol = (m_b0 * h + m_c0) * h + m_y[0];</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                interpol = m_c0 * h + m_y[0];</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt; m_x[n - 1]) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="comment">// extrapolation to the right</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">if</span> (isCubic) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                interpol = (m_b[n - 1] * h + m_c[n - 1]) * h + m_y[n - 1];</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                interpol = m_c[n - 1] * h + m_y[n - 1];</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="comment">// interpolation</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">if</span> (isCubic) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                interpol = ((m_a[idx] * h + m_b[idx]) * h + m_c[idx]) * h + m_y[idx];</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                interpol = m_c[idx] * h + m_y[idx];</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">return</span> interpol;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#a84e3fd8c92776110e0395f11ec5c5b39">  289</a></span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1spline.html#a84e3fd8c92776110e0395f11ec5c5b39">operator()</a>(<a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; x, <span class="keywordtype">int</span> idx, <span class="keyword">const</span> <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; dm_x, <span class="keyword">const</span> <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; dm_y)<span class="keyword"> const</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> h = x - dm_x;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">if</span> (isCubic)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">return</span> ((m_a[idx] * h + m_b[idx]) * h + m_c[idx]) * h + dm_y;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">return</span> m_c[idx] * h + dm_y;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// Compute derivatives</span></div><div class="line"><a name="l00299"></a><span class="lineno"><a class="line" href="classtk_1_1spline.html#aca797863adc5b9a8abc2f0518e00aa2e">  299</a></span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1spline.html#aca797863adc5b9a8abc2f0518e00aa2e">deriv</a>(<span class="keywordtype">int</span> order, <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> x)<span class="keyword"> const</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        assert(order &gt; 0);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordtype">size_t</span> n = m_x.size();</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">// find the closest point m_x[idx] &lt; x, idx=0 even if x&lt;m_x[0]</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordtype">int</span> idx = <a class="code" href="classtk_1_1spline.html#a8400559a8bfbdc33528b1744109959ac">mx_lower_bound</a>(0, m_x.n_elem, x);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> h = x - m_x[idx];</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> interpol;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> (x &lt; m_x[0]) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="comment">// extrapolation to the left</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">switch</span> (order) {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                interpol = 2.0 * m_b0 * h + m_c0;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                interpol = 2.0 * m_b0 * h;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                interpol = 0.0;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &gt; m_x[n - 1]) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="comment">// extrapolation to the right</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">switch</span> (order) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                interpol = 2.0 * m_b[n - 1] * h + m_c[n - 1];</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                interpol = 2.0 * m_b[n - 1];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                interpol = 0.0;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">// interpolation</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">switch</span> (order) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                interpol = (3.0 * m_a[idx] * h + 2.0 * m_b[idx]) * h + m_c[idx];</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                interpol = 6.0 * m_a[idx] * h + 2.0 * m_b[idx];</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                interpol = 6.0 * m_a[idx];</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                interpol = 0.0;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordflow">return</span> interpol;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;};</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="classtk_1_1linearspline.html">  361</a></span>&#160;<span class="keyword">class </span><a class="code" href="classtk_1_1linearspline.html">linearspline</a> {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    arma::Col&lt;real_t&gt; m_x, m_y; <span class="comment">// x,y coordinates of points</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// interpolation parameters</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">// f(x) = a*(x-x_i) + y_i</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    arma::Col&lt;real_t&gt; m_a; <span class="comment">// spline coefficients</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="classtk_1_1linearspline.html#afd300472c2d18ca2ca7243c39b906906">  372</a></span>&#160;    <a class="code" href="classtk_1_1linearspline.html#afd300472c2d18ca2ca7243c39b906906">linearspline</a>()</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classtk_1_1linearspline.html#aba0686c641e4a41855cf3b289d5cf541">set_points</a>(<span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; x, <span class="keyword">const</span> arma::Col&lt;real_t&gt;&amp; y, <span class="keywordtype">bool</span> copy = <span class="keyword">true</span>);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1linearspline.html#af0544df1eb44fcbcb337e954bc545b77">operator()</a>(<a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> x) <span class="keyword">const</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> <a class="code" href="classtk_1_1linearspline.html#af0544df1eb44fcbcb337e954bc545b77">operator()</a>(<a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; x, <span class="keywordtype">int</span> idx, <span class="keyword">const</span> <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; dm_x, <span class="keyword">const</span> <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a>&amp; dm_y) <span class="keyword">const</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="classtk_1_1linearspline.html#a1eff079513001faf9097a0f1abe70d00">mx_lower_bound</a>(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last, <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> x) <span class="keyword">const</span>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;};</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;} <span class="comment">// namespace tk</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* TK_SPLINE_H */</span><span class="preprocessor"></span></div><div class="ttc" id="classtk_1_1band__matrix_html_a58c5621f3a2b81621b8a52d2e7fd2da5"><div class="ttname"><a href="classtk_1_1band__matrix.html#a58c5621f3a2b81621b8a52d2e7fd2da5">tk::band_matrix::lu_decompose</a></div><div class="ttdeci">void lu_decompose()</div><div class="ttdef"><b>Definition:</b> spline.cpp:93</div></div>
<div class="ttc" id="classtk_1_1spline_html_a84e3fd8c92776110e0395f11ec5c5b39"><div class="ttname"><a href="classtk_1_1spline.html#a84e3fd8c92776110e0395f11ec5c5b39">tk::spline::operator()</a></div><div class="ttdeci">real_t operator()(real_t &amp;x, int idx, const real_t &amp;dm_x, const real_t &amp;dm_y) const</div><div class="ttdoc">Compute interpolation value at indicated location. </div><div class="ttdef"><b>Definition:</b> spline.h:289</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a1d5af61e7df839f41ca2957176ca4cff"><div class="ttname"><a href="classtk_1_1band__matrix.html#a1d5af61e7df839f41ca2957176ca4cff">tk::band_matrix::~band_matrix</a></div><div class="ttdeci">~band_matrix()</div><div class="ttdef"><b>Definition:</b> spline.h:43</div></div>
<div class="ttc" id="classtk_1_1linearspline_html"><div class="ttname"><a href="classtk_1_1linearspline.html">tk::linearspline</a></div><div class="ttdoc">The linear spline class. </div><div class="ttdef"><b>Definition:</b> spline.h:361</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a22a4e9304b833c37b5c76576aeb3abf0"><div class="ttname"><a href="classtk_1_1band__matrix.html#a22a4e9304b833c37b5c76576aeb3abf0">tk::band_matrix::operator()</a></div><div class="ttdeci">real_t &amp; operator()(int i, int j)</div><div class="ttdef"><b>Definition:</b> spline.cpp:58</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a1d1f0012bb1ac68667de630a809d947b"><div class="ttname"><a href="classtk_1_1band__matrix.html#a1d1f0012bb1ac68667de630a809d947b">tk::band_matrix::dim</a></div><div class="ttdeci">int dim() const</div><div class="ttdef"><b>Definition:</b> spline.cpp:47</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a5a62f404ad5ae5cf01229e975eb3f2e6"><div class="ttname"><a href="classtk_1_1band__matrix.html#a5a62f404ad5ae5cf01229e975eb3f2e6">tk::band_matrix::band_matrix</a></div><div class="ttdeci">band_matrix()</div><div class="ttdef"><b>Definition:</b> spline.h:41</div></div>
<div class="ttc" id="classtk_1_1spline_html_a592e5cbe6ad482196774443b1e84f7dca36155d20be4c44f424eabc5855853216"><div class="ttname"><a href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca36155d20be4c44f424eabc5855853216">tk::spline::first_deriv</a></div><div class="ttdef"><b>Definition:</b> spline.h:75</div></div>
<div class="ttc" id="classtk_1_1spline_html_aca797863adc5b9a8abc2f0518e00aa2e"><div class="ttname"><a href="classtk_1_1spline.html#aca797863adc5b9a8abc2f0518e00aa2e">tk::spline::deriv</a></div><div class="ttdeci">real_t deriv(int order, real_t x) const</div><div class="ttdef"><b>Definition:</b> spline.h:299</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a0c7d6395a84db25a968952e23fa30bab"><div class="ttname"><a href="classtk_1_1band__matrix.html#a0c7d6395a84db25a968952e23fa30bab">tk::band_matrix::r_solve</a></div><div class="ttdeci">arma::Col&lt; real_t &gt; r_solve(const arma::Col&lt; real_t &gt; &amp;b) const</div><div class="ttdef"><b>Definition:</b> spline.cpp:144</div></div>
<div class="ttc" id="classtk_1_1linearspline_html_afd300472c2d18ca2ca7243c39b906906"><div class="ttname"><a href="classtk_1_1linearspline.html#afd300472c2d18ca2ca7243c39b906906">tk::linearspline::linearspline</a></div><div class="ttdeci">linearspline()</div><div class="ttdoc">Linear spline constructor. </div><div class="ttdef"><b>Definition:</b> spline.h:372</div></div>
<div class="ttc" id="classtk_1_1spline_html_a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889"><div class="ttname"><a href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dca9244b2ba338202f621bdeafb149d4889">tk::spline::second_deriv</a></div><div class="ttdef"><b>Definition:</b> spline.h:76</div></div>
<div class="ttc" id="classtk_1_1spline_html"><div class="ttname"><a href="classtk_1_1spline.html">tk::spline</a></div><div class="ttdoc">The spline class. </div><div class="ttdef"><b>Definition:</b> spline.h:72</div></div>
<div class="ttc" id="classtk_1_1spline_html_a39834bd1f061c6eacc4f6c45ab8e0b41"><div class="ttname"><a href="classtk_1_1spline.html#a39834bd1f061c6eacc4f6c45ab8e0b41">tk::spline::set_boundary</a></div><div class="ttdeci">void set_boundary(bd_type left, real_t left_value, bd_type right, real_t right_value, bool force_linear_extrapolation=false)</div><div class="ttdoc">Set default boundary conditions Optional, but if called it has to come be before set_points() ...</div><div class="ttdef"><b>Definition:</b> spline.h:108</div></div>
<div class="ttc" id="classtk_1_1linearspline_html_aba0686c641e4a41855cf3b289d5cf541"><div class="ttname"><a href="classtk_1_1linearspline.html#aba0686c641e4a41855cf3b289d5cf541">tk::linearspline::set_points</a></div><div class="ttdeci">void set_points(const arma::Col&lt; real_t &gt; &amp;x, const arma::Col&lt; real_t &gt; &amp;y, bool copy=true)</div><div class="ttdef"><b>Definition:</b> spline.cpp:175</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_ab97d8bd7a025c3a9fb1202a65d2d3d93"><div class="ttname"><a href="classtk_1_1band__matrix.html#ab97d8bd7a025c3a9fb1202a65d2d3d93">tk::band_matrix::lu_solve</a></div><div class="ttdeci">arma::Col&lt; real_t &gt; lu_solve(const arma::Col&lt; real_t &gt; &amp;b, bool is_lu_decomposed=false)</div><div class="ttdef"><b>Definition:</b> spline.cpp:160</div></div>
<div class="ttc" id="classtk_1_1spline_html_aa775760d2db2bd9c281f23cfdc264896"><div class="ttname"><a href="classtk_1_1spline.html#aa775760d2db2bd9c281f23cfdc264896">tk::spline::set_points</a></div><div class="ttdeci">void set_points(const arma::Col&lt; real_t &gt; &amp;x, const arma::Col&lt; real_t &gt; &amp;y, bool copy=true)</div><div class="ttdoc">Set points for interpolation If copy parameter is false, data is not stored internally. This provides computational savings since memcopy operations are not performed. </div><div class="ttdef"><b>Definition:</b> spline.h:129</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a964e9950c0f778b13a963e4acfa8d6ae"><div class="ttname"><a href="classtk_1_1band__matrix.html#a964e9950c0f778b13a963e4acfa8d6ae">tk::band_matrix::num_upper</a></div><div class="ttdeci">int num_upper() const</div><div class="ttdef"><b>Definition:</b> spline.h:46</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a57b351eff7db8c9875a5204ea3132d42"><div class="ttname"><a href="classtk_1_1band__matrix.html#a57b351eff7db8c9875a5204ea3132d42">tk::band_matrix::num_lower</a></div><div class="ttdeci">int num_lower() const</div><div class="ttdef"><b>Definition:</b> spline.h:50</div></div>
<div class="ttc" id="classtk_1_1spline_html_a592e5cbe6ad482196774443b1e84f7dc"><div class="ttname"><a href="classtk_1_1spline.html#a592e5cbe6ad482196774443b1e84f7dc">tk::spline::bd_type</a></div><div class="ttdeci">bd_type</div><div class="ttdef"><b>Definition:</b> spline.h:74</div></div>
<div class="ttc" id="classtk_1_1spline_html_a8400559a8bfbdc33528b1744109959ac"><div class="ttname"><a href="classtk_1_1spline.html#a8400559a8bfbdc33528b1744109959ac">tk::spline::mx_lower_bound</a></div><div class="ttdeci">int mx_lower_bound(int first, int last, real_t x) const</div><div class="ttdef"><b>Definition:</b> spline.h:222</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_adaace3f1ce985888f2b7ef9c4fd4d166"><div class="ttname"><a href="classtk_1_1band__matrix.html#adaace3f1ce985888f2b7ef9c4fd4d166">tk::band_matrix::l_solve</a></div><div class="ttdeci">arma::Col&lt; real_t &gt; l_solve(const arma::Col&lt; real_t &gt; &amp;b) const</div><div class="ttdef"><b>Definition:</b> spline.cpp:128</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html"><div class="ttname"><a href="classtk_1_1band__matrix.html">tk::band_matrix</a></div><div class="ttdef"><b>Definition:</b> spline.h:36</div></div>
<div class="ttc" id="classtk_1_1linearspline_html_af0544df1eb44fcbcb337e954bc545b77"><div class="ttname"><a href="classtk_1_1linearspline.html#af0544df1eb44fcbcb337e954bc545b77">tk::linearspline::operator()</a></div><div class="ttdeci">real_t operator()(real_t x) const</div><div class="ttdef"><b>Definition:</b> spline.cpp:210</div></div>
<div class="ttc" id="classtk_1_1linearspline_html_a1eff079513001faf9097a0f1abe70d00"><div class="ttname"><a href="classtk_1_1linearspline.html#a1eff079513001faf9097a0f1abe70d00">tk::linearspline::mx_lower_bound</a></div><div class="ttdeci">int mx_lower_bound(int first, int last, real_t x) const</div><div class="ttdef"><b>Definition:</b> spline.cpp:196</div></div>
<div class="ttc" id="classtk_1_1spline_html_a62687d7d2fcd1dbe07576bf937c088a7"><div class="ttname"><a href="classtk_1_1spline.html#a62687d7d2fcd1dbe07576bf937c088a7">tk::spline::spline</a></div><div class="ttdeci">spline()</div><div class="ttdoc">Spline class constructor. </div><div class="ttdef"><b>Definition:</b> spline.h:95</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_ac228b0ec7dcb4546295b807c7ea1538e"><div class="ttname"><a href="classtk_1_1band__matrix.html#ac228b0ec7dcb4546295b807c7ea1538e">tk::band_matrix::setsize</a></div><div class="ttdeci">void setsize(int dim, int n_u, int n_l)</div><div class="ttdef"><b>Definition:</b> spline.cpp:39</div></div>
<div class="ttc" id="classtk_1_1band__matrix_html_a4fd9ed003c3f0705cc7b18c2eae5c684"><div class="ttname"><a href="classtk_1_1band__matrix.html#a4fd9ed003c3f0705cc7b18c2eae5c684">tk::band_matrix::saved_diag</a></div><div class="ttdeci">real_t &amp; saved_diag(int i)</div><div class="ttdef"><b>Definition:</b> spline.cpp:86</div></div>
<div class="ttc" id="namespacetk_html"><div class="ttname"><a href="namespacetk.html">tk</a></div><div class="ttdef"><b>Definition:</b> spline.cpp:31</div></div>
<div class="ttc" id="types_8h_html_ab46614359717672dc9a4eed4669be6e6"><div class="ttname"><a href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a></div><div class="ttdeci">double real_t</div><div class="ttdef"><b>Definition:</b> types.h:17</div></div>
<div class="ttc" id="classtk_1_1spline_html_a7071258ec9307832dce2ae288bd5dbf5"><div class="ttname"><a href="classtk_1_1spline.html#a7071258ec9307832dce2ae288bd5dbf5">tk::spline::operator()</a></div><div class="ttdeci">real_t operator()(real_t x) const</div><div class="ttdoc">Compute interpolation value at indicated location. </div><div class="ttdef"><b>Definition:</b> spline.h:244</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
