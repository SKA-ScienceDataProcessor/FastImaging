<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Slow Transients Pipeline Prototype: /home/lucas/skadev/FastImaging/src/stp/imager/imager.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="science_data_processor_logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Slow Transients Pipeline Prototype
   </div>
   <div id="projectbrief">Component of the Science Data Processor being developed in the context of the Square Kilometre Array international project, which provides fast snapshot imaging, object detection and cataloguing for the identification of astrophysical image-plane transients.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_71906deff00c706128a95d3938125d0a.html">stp</a></li><li class="navelem"><a class="el" href="dir_1f622e932ecdac32f27bb9f51d8e4400.html">imager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">imager.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="imager_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#ifndef IMAGER_H</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#define IMAGER_H</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// STP library includes</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;../common/fft.h&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;../gridder/gridder.h&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;../types.h&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="imager_8h.html#ad560e7fb8564c991d39374775a382e80">   14</a></span>&#160;<span class="preprocessor">#define arc_sec_to_rad(value) ((value / 3600.0) * (M_PI / 180.0))</span></div><div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="imager_8h.html#aff561d3c5356a07f3f43855a3e955de8">   15</a></span>&#160;<span class="preprocessor">#define NUM_TIME_INST 10</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacestp.html">stp</a> {</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#ifdef FUNCTION_TIMINGS</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">extern</span> std::vector&lt;std::chrono::high_resolution_clock::time_point&gt; times_iv;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacestp.html#a095277dc88e800af18a5e1e9e803792e">convert_to_halfplane_visibilities</a>(arma::mat&amp; uv_in_pixels, arma::cx_mat&amp; vis, arma::mat&amp; vis_weights, <span class="keywordtype">int</span> kernel_support);</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="namespacestp.html#a7e61918609243705d9649a09c4efd1ba">   58</a></span>&#160;std::pair&lt;arma::Mat&lt;real_t&gt;, arma::Mat&lt;real_t&gt;&gt; <a class="code" href="namespacestp.html#a7e61918609243705d9649a09c4efd1ba">image_visibilities</a>(</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">const</span> T kernel_creator,</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keyword">const</span> arma::cx_mat&amp; vis,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">const</span> arma::mat&amp; vis_weights,</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keyword">const</span> arma::mat&amp; uvw_lambda,</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> image_size,</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">double</span> cell_size,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">int</span> kernel_support,</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">bool</span> kernel_exact = <span class="keyword">true</span>,</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordtype">int</span> oversampling = 1,</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">bool</span> generate_beam = <span class="keyword">false</span>,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98">FFTRoutine</a> r_fft = <a class="code" href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98a1551a8f00e3ff5f46b18636fb963ad8c">FFTRoutine::FFTW_ESTIMATE_FFT</a>,</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keyword">const</span> std::string&amp; fft_wisdom_filename = std::string())</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    assert(kernel_exact || (oversampling &gt;= 1)); <span class="comment">// If kernel exact is false, then oversampling must be &gt;= 1</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    assert(image_size &gt; 0);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    assert(kernel_support &gt; 0);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    assert(cell_size &gt; 0.0);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    assert(vis.n_elem == vis_weights.n_elem);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#ifdef FUNCTION_TIMINGS</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    times_iv.reserve(<a class="code" href="imager_8h.html#aff561d3c5356a07f3f43855a3e955de8">NUM_TIME_INST</a>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    times_iv.push_back(std::chrono::high_resolution_clock::now());</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// Size of a UV-grid pixel, in multiples of wavelength (lambda):</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">double</span> grid_pixel_width_lambda = (1.0 / (<a class="code" href="imager_8h.html#ad560e7fb8564c991d39374775a382e80">arc_sec_to_rad</a>(cell_size) * double(image_size)));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    arma::mat uv_in_pixels = (uvw_lambda / grid_pixel_width_lambda);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    arma::cx_mat conv_vis = vis;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    arma::mat conv_vis_weights = vis_weights;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// Remove W column</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    uv_in_pixels.shed_col(2);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// If a visibility point is located in the top half-plane, move it to the bottom half-plane to a symmetric position with respect to the matrix centre (0,0)</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="namespacestp.html#a095277dc88e800af18a5e1e9e803792e">convert_to_halfplane_visibilities</a>(uv_in_pixels, conv_vis, conv_vis_weights, kernel_support);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// Perform convolutional gridding of complex visibilities</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <a class="code" href="classstp_1_1_gridder_output.html">GridderOutput</a> gridded_data;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (generate_beam) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        gridded_data = convolve_to_grid&lt;true&gt;(kernel_creator, kernel_support, image_size, uv_in_pixels, conv_vis, conv_vis_weights, kernel_exact, oversampling);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        gridded_data = convolve_to_grid&lt;false&gt;(kernel_creator, kernel_support, image_size, uv_in_pixels, conv_vis, conv_vis_weights, kernel_exact, oversampling);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#ifdef FUNCTION_TIMINGS</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    times_iv.push_back(std::chrono::high_resolution_clock::now());</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    arma::Mat&lt;real_t&gt; fft_result_image;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    arma::Mat&lt;real_t&gt; fft_result_beam;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Reuse gridded_data buffer if FFT is INPLACE</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (r_fft == <a class="code" href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98ac68eed57a11ce9105b7e0355d5b2e84d">stp::FFTRoutine::FFTW_WISDOM_INPLACE_FFT</a>) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        fft_result_image = std::move(arma::Mat&lt;real_t&gt;(reinterpret_cast&lt;real_t*&gt;(gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a49a6dc4b250eff5150ec560daf3c33f5">vis_grid</a>.memptr()), (gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a49a6dc4b250eff5150ec560daf3c33f5">vis_grid</a>.n_rows) * 2, gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a49a6dc4b250eff5150ec560daf3c33f5">vis_grid</a>.n_cols, <span class="keyword">false</span>, <span class="keyword">false</span>));</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        fft_result_beam = std::move(arma::Mat&lt;real_t&gt;(reinterpret_cast&lt;real_t*&gt;(gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a02d28321016ab51f04ecb17431583d8c">sampling_grid</a>.memptr()), (gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a02d28321016ab51f04ecb17431583d8c">sampling_grid</a>.n_rows) * 2, gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a02d28321016ab51f04ecb17431583d8c">sampling_grid</a>.n_cols, <span class="keyword">false</span>, <span class="keyword">false</span>));</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// Run iFFT over convolved matrices</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">// First: FFT of image matrix</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="namespacestp.html#a4af482cb10c30fd252b434dd0aef3074">fft_fftw_c2r</a>(gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a49a6dc4b250eff5150ec560daf3c33f5">vis_grid</a>, fft_result_image, r_fft, fft_wisdom_filename);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// Delete gridded image matrix (only if FFT is not inplace)</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (r_fft != <a class="code" href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98ac68eed57a11ce9105b7e0355d5b2e84d">stp::FFTRoutine::FFTW_WISDOM_INPLACE_FFT</a>) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a49a6dc4b250eff5150ec560daf3c33f5">vis_grid</a>.<a class="code" href="classstp_1_1_mat_stp.html#a647f2e90b61e3e2a43c9f3baa8b3c248">delete_matrix_buffer</a>();</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#ifdef FFTSHIFT</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="namespacestp.html#a8147549e9e6af9bc222ab8bd39c4407d">fftshift</a>(fft_result_image);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// Second: FFT of beam matrix (optional)</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">if</span> (generate_beam) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="namespacestp.html#a4af482cb10c30fd252b434dd0aef3074">fft_fftw_c2r</a>(gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a02d28321016ab51f04ecb17431583d8c">sampling_grid</a>, fft_result_beam, r_fft, fft_wisdom_filename);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// Delete gridded beam matrix (only if FFT is not inplace)</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (r_fft != <a class="code" href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98ac68eed57a11ce9105b7e0355d5b2e84d">stp::FFTRoutine::FFTW_WISDOM_INPLACE_FFT</a>) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a02d28321016ab51f04ecb17431583d8c">sampling_grid</a>.<a class="code" href="classstp_1_1_mat_stp.html#a647f2e90b61e3e2a43c9f3baa8b3c248">delete_matrix_buffer</a>();</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#ifdef FFTSHIFT</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="namespacestp.html#a8147549e9e6af9bc222ab8bd39c4407d">fftshift</a>(fft_result_beam);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#ifdef FUNCTION_TIMINGS</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    times_iv.push_back(std::chrono::high_resolution_clock::now());</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// Normalize image and beam</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span> (gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a7e3e3dc1f24e7c5e3caff9611bd0e298">sample_grid_total</a> &gt; 0.0) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <a class="code" href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a> normalization_factor = 1.0 / (gridded_data.<a class="code" href="classstp_1_1_gridder_output.html#a7e3e3dc1f24e7c5e3caff9611bd0e298">sample_grid_total</a>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">// Image</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        tbb::parallel_for(tbb::blocked_range&lt;size_t&gt;(0, fft_result_image.n_elem), [&amp;](<span class="keyword">const</span> tbb::blocked_range&lt;size_t&gt;&amp; r) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            for (arma::uword i = r.begin(); i &lt; r.end(); ++i) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                fft_result_image[i] *= normalization_factor;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        });</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// Beam is optional</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> (generate_beam) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            tbb::parallel_for(tbb::blocked_range&lt;size_t&gt;(0, fft_result_beam.n_elem), [&amp;](<span class="keyword">const</span> tbb::blocked_range&lt;size_t&gt;&amp; r) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                for (arma::uword i = r.begin(); i &lt; r.end(); ++i) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    fft_result_beam[i] *= normalization_factor;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            });</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#ifdef FUNCTION_TIMINGS</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    times_iv.push_back(std::chrono::high_resolution_clock::now());</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> std::make_pair(std::move(fft_result_image), std::move(fft_result_beam));</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* IMAGER_H */</span><span class="preprocessor"></span></div><div class="ttc" id="imager_8h_html_ad560e7fb8564c991d39374775a382e80"><div class="ttname"><a href="imager_8h.html#ad560e7fb8564c991d39374775a382e80">arc_sec_to_rad</a></div><div class="ttdeci">#define arc_sec_to_rad(value)</div><div class="ttdef"><b>Definition:</b> imager.h:14</div></div>
<div class="ttc" id="namespacestp_html_a464d541245c3d8f9ea82f5d2d5484c98"><div class="ttname"><a href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98">stp::FFTRoutine</a></div><div class="ttdeci">FFTRoutine</div><div class="ttdoc">Enum of available FFT algorithms. </div><div class="ttdef"><b>Definition:</b> types.h:42</div></div>
<div class="ttc" id="namespacestp_html_a4af482cb10c30fd252b434dd0aef3074"><div class="ttname"><a href="namespacestp.html#a4af482cb10c30fd252b434dd0aef3074">stp::fft_fftw_c2r</a></div><div class="ttdeci">void fft_fftw_c2r(arma::Mat&lt; cx_real_t &gt; &amp;input, arma::Mat&lt; real_t &gt; &amp;output, FFTRoutine r_fft, const std::string &amp;wisdom_filename)</div><div class="ttdoc">Performs the backward fast fourier transform on a halfplane complex matrix using the FFTW library (co...</div><div class="ttdef"><b>Definition:</b> fft.cpp:13</div></div>
<div class="ttc" id="classstp_1_1_gridder_output_html"><div class="ttname"><a href="classstp_1_1_gridder_output.html">stp::GridderOutput</a></div><div class="ttdoc">The gridder output class. </div><div class="ttdef"><b>Definition:</b> gridder.h:25</div></div>
<div class="ttc" id="namespacestp_html_a464d541245c3d8f9ea82f5d2d5484c98a1551a8f00e3ff5f46b18636fb963ad8c"><div class="ttname"><a href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98a1551a8f00e3ff5f46b18636fb963ad8c">stp::FFTRoutine::FFTW_ESTIMATE_FFT</a></div></div>
<div class="ttc" id="namespacestp_html_a464d541245c3d8f9ea82f5d2d5484c98ac68eed57a11ce9105b7e0355d5b2e84d"><div class="ttname"><a href="namespacestp.html#a464d541245c3d8f9ea82f5d2d5484c98ac68eed57a11ce9105b7e0355d5b2e84d">stp::FFTRoutine::FFTW_WISDOM_INPLACE_FFT</a></div></div>
<div class="ttc" id="imager_8h_html_aff561d3c5356a07f3f43855a3e955de8"><div class="ttname"><a href="imager_8h.html#aff561d3c5356a07f3f43855a3e955de8">NUM_TIME_INST</a></div><div class="ttdeci">#define NUM_TIME_INST</div><div class="ttdef"><b>Definition:</b> imager.h:15</div></div>
<div class="ttc" id="namespacestp_html_a7e61918609243705d9649a09c4efd1ba"><div class="ttname"><a href="namespacestp.html#a7e61918609243705d9649a09c4efd1ba">stp::image_visibilities</a></div><div class="ttdeci">std::pair&lt; arma::Mat&lt; real_t &gt;, arma::Mat&lt; real_t &gt; &gt; image_visibilities(const T kernel_creator, const arma::cx_mat &amp;vis, const arma::mat &amp;vis_weights, const arma::mat &amp;uvw_lambda, int image_size, double cell_size, int kernel_support, bool kernel_exact=true, int oversampling=1, bool generate_beam=false, FFTRoutine r_fft=FFTRoutine::FFTW_ESTIMATE_FFT, const std::string &amp;fft_wisdom_filename=std::string())</div><div class="ttdoc">Generates image and beam data from input visibilities. </div><div class="ttdef"><b>Definition:</b> imager.h:58</div></div>
<div class="ttc" id="namespacestp_html_a8147549e9e6af9bc222ab8bd39c4407d"><div class="ttname"><a href="namespacestp.html#a8147549e9e6af9bc222ab8bd39c4407d">stp::fftshift</a></div><div class="ttdeci">void fftshift(arma::Mat&lt; T &gt; &amp;m, bool is_forward=true)</div><div class="ttdoc">Performs matrix circular shift as needed for iFFT. </div><div class="ttdef"><b>Definition:</b> fft.h:60</div></div>
<div class="ttc" id="namespacestp_html_a095277dc88e800af18a5e1e9e803792e"><div class="ttname"><a href="namespacestp.html#a095277dc88e800af18a5e1e9e803792e">stp::convert_to_halfplane_visibilities</a></div><div class="ttdeci">void convert_to_halfplane_visibilities(arma::mat &amp;uv_in_pixels, arma::cx_mat &amp;vis, arma::mat &amp;vis_weights, int kernel_support)</div><div class="ttdoc">Convert the input visibilities to an array of half-plane visibilities. </div><div class="ttdef"><b>Definition:</b> imager.cpp:12</div></div>
<div class="ttc" id="classstp_1_1_gridder_output_html_a02d28321016ab51f04ecb17431583d8c"><div class="ttname"><a href="classstp_1_1_gridder_output.html#a02d28321016ab51f04ecb17431583d8c">stp::GridderOutput::sampling_grid</a></div><div class="ttdeci">MatStp&lt; cx_real_t &gt; sampling_grid</div><div class="ttdef"><b>Definition:</b> gridder.h:42</div></div>
<div class="ttc" id="classstp_1_1_gridder_output_html_a49a6dc4b250eff5150ec560daf3c33f5"><div class="ttname"><a href="classstp_1_1_gridder_output.html#a49a6dc4b250eff5150ec560daf3c33f5">stp::GridderOutput::vis_grid</a></div><div class="ttdeci">MatStp&lt; cx_real_t &gt; vis_grid</div><div class="ttdef"><b>Definition:</b> gridder.h:38</div></div>
<div class="ttc" id="namespacestp_html"><div class="ttname"><a href="namespacestp.html">stp</a></div><div class="ttdef"><b>Definition:</b> ccl.cpp:17</div></div>
<div class="ttc" id="classstp_1_1_mat_stp_html_a647f2e90b61e3e2a43c9f3baa8b3c248"><div class="ttname"><a href="classstp_1_1_mat_stp.html#a647f2e90b61e3e2a43c9f3baa8b3c248">stp::MatStp::delete_matrix_buffer</a></div><div class="ttdeci">void delete_matrix_buffer()</div><div class="ttdoc">Delete matrix buffer. </div><div class="ttdef"><b>Definition:</b> matstp.h:143</div></div>
<div class="ttc" id="classstp_1_1_gridder_output_html_a7e3e3dc1f24e7c5e3caff9611bd0e298"><div class="ttname"><a href="classstp_1_1_gridder_output.html#a7e3e3dc1f24e7c5e3caff9611bd0e298">stp::GridderOutput::sample_grid_total</a></div><div class="ttdeci">double sample_grid_total</div><div class="ttdef"><b>Definition:</b> gridder.h:43</div></div>
<div class="ttc" id="types_8h_html_ab46614359717672dc9a4eed4669be6e6"><div class="ttname"><a href="types_8h.html#ab46614359717672dc9a4eed4669be6e6">real_t</a></div><div class="ttdeci">double real_t</div><div class="ttdef"><b>Definition:</b> types.h:16</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
